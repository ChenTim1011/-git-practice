[Problems](https://leetcode.com/problems/timeout-cancellation/?envType=study-plan-v2&envId=30-days-of-javascript)

---

## timeout-cancellation


**å‹•æ©Ÿï¼ˆMotiveï¼‰**ï¼šåœ¨ç‰¹å®šæ™‚é–“å¾Œå›žå‚³ä¸€å€‹å‡½æ•¸ï¼Œåƒ…åœ¨æ‚¨æ²’æœ‰èª¿ç”¨å…¶ä»–å‡½æ•¸çš„æƒ…æ³ä¸‹ã€‚å¦‚æžœæˆ‘å€‘èª¿ç”¨äº†å…¶ä»–å‡½æ•¸ï¼Œå‰‡ç¬¬ä¸€å€‹å‡½æ•¸æ ¹æœ¬ä¸æ‡‰è©²è¢«èª¿ç”¨ï¼

**å…ˆæ±ºæ¢ä»¶ï¼ˆPre-Requisitesï¼‰**ï¼š

- ç†Ÿæ‚‰å›žå‘¼å‡½æ•¸ï¼ˆcallback functionsï¼‰
- å‰©é¤˜åƒæ•¸ï¼ˆRest parameterï¼‰
- `clearTimeout` å’Œ `setTimeout` æ–¹æ³•

**æ‚¨å¯èƒ½æœƒå•çš„å•é¡Œ**ï¼šç‚ºä»€éº¼æˆ‘éœ€è¦ä½¿ç”¨ `clearTimeout` å’Œ `setTimeout`ï¼Ÿ

åœ¨ JavaScript ä¸­ï¼ŒæŽ§åˆ¶æµç¨‹å’Œä»»å‹™çš„åŸ·è¡Œæ˜¯ç›¸ç•¶é—œéµçš„ã€‚ä»¥ä¸‹çš„å…©å€‹å•é¡Œï¼ˆå¸¶æœ‰å»¶é²çš„å¯å–æ¶ˆå‡½æ•¸åŸ·è¡Œï¼‰å’Œï¼ˆé–“éš”å–æ¶ˆï¼‰æ¶‰åŠäº†ä¸€å€‹éžå¸¸éžå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè«‹è€å¿ƒé–±è®€ ðŸ˜Šï¼

é€šéŽä½¿ç”¨é€™äº›æ–¹æ³•ï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†åœ°æŽ§åˆ¶ç¨‹å¼ç¢¼çš„æ™‚æ©Ÿå’ŒåŸ·è¡Œï¼Œæˆ‘å€‘å¯ä»¥å»¶é²æˆ–å–æ¶ˆå®ƒå€‘ã€‚

**å¥½çš„ï¼Œæˆ‘æ˜Žç™½å®ƒå€‘å¾ˆé‡è¦ï¼Œä½†æˆ‘åœ¨å“ªè£¡æœƒç”¨åˆ°å®ƒå€‘å‘¢ï¼ŸðŸ¤”**

å®ƒå€‘åœ¨ä»¥ä¸‹å ´æ™¯ä¸­è¢«å»£æ³›ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š

- å‹•ç•«ï¼ˆAnimationï¼‰
- äº‹ä»¶è™•ç†ï¼ˆEvent Handlingï¼‰
- æŽ’ç¨‹ï¼ˆSchedulingï¼‰
- éžåŒæ­¥ç¨‹å¼ï¼ˆAsync Programmingï¼‰

**æ‚¨å¯èƒ½æœƒå•çš„å…¶ä»–å•é¡Œ**ï¼š

å—¯â€¦â€¦æˆ‘ä»¥ç‚ºæˆ‘ç†è§£å®ƒå€‘ï¼Œçµæžœç™¼ç¾æˆ‘åªçŸ¥é“èªžæ³•ã€‚

æ²’é—œä¿‚ï¼Œæˆ‘æœƒå®Œæ•´åœ°è§£é‡‹ï¼Œä¸ç”¨æ“”å¿ƒï¼

è®“æˆ‘å€‘å¾ž `setTimeout` æ–¹æ³•é–‹å§‹ï¼š

- é€™å€‹å‡½æ•¸æŽ¥å—å…©å€‹åƒæ•¸ï¼šä¸€å€‹å›žå‘¼å‡½æ•¸å’Œä¸€å€‹ä»¥æ¯«ç§’ç‚ºå–®ä½çš„å»¶é²å€¼ã€‚å›žå‘¼å‡½æ•¸ä»£è¡¨æˆ‘å€‘å¸Œæœ›åœ¨å»¶é²å¾ŒåŸ·è¡Œçš„ç¨‹å¼ç¢¼ã€‚
- ç•¶æˆ‘å€‘èª¿ç”¨ `setTimeout`ï¼Œå®ƒæœƒè¨»å†Šå›žå‘¼å‡½æ•¸ä¸¦å•Ÿå‹•ä¸€å€‹è¨ˆæ™‚å™¨ã€‚æŒ‡å®šçš„å»¶é²å¾Œï¼ŒJavaScript å¼•æ“Žæœƒå°‡å›žå‘¼å‡½æ•¸æ·»åŠ åˆ°äº‹ä»¶éšŠåˆ—ä¸­ã€‚
- å¦‚æžœæ‚¨ä¸çŸ¥é“ä»€éº¼æ˜¯äº‹ä»¶ä½‡åˆ—ï¼Œäº‹ä»¶éšŠåˆ—æ˜¯ä¸€ç¨®è³‡æ–™çµæ§‹ï¼Œç”¨æ–¼å­˜å„²ç”± JavaScript é‹è¡Œæ™‚è™•ç†çš„ä»»å‹™ã€‚ç•¶èª¿ç”¨æ£§ï¼ˆcall stackï¼‰ç‚ºç©ºæ™‚ï¼ˆæ‰€æœ‰åŒæ­¥ç¨‹å¼ç¢¼å·²ç¶“å®ŒæˆåŸ·è¡Œï¼‰ï¼Œé‹è¡Œæ™‚æœƒå¾žäº‹ä»¶éšŠåˆ—ä¸­é¸æ“‡ä¸‹ä¸€å€‹ä»»å‹™ä¸¦åŸ·è¡Œå®ƒã€‚
- é€šéŽä½¿ç”¨ `setTimeout`ï¼Œæˆ‘å€‘åœ¨ç¨‹å¼ç¢¼ä¸­å¼•å…¥äº†éžåŒæ­¥è¡Œç‚ºã€‚é€™æ„å‘³è‘—åœ¨å»¶é²å€’è¨ˆæ™‚æœŸé–“ï¼ŒJavaScript å¼•æ“Žå¯ä»¥ç¹¼çºŒåŸ·è¡Œå…¶ä»–ç¨‹å¼ç¢¼ï¼Œè€Œä¸éœ€è¦ç­‰å¾… `setTimeout` çš„å›žå‘¼è¢«èª¿ç”¨ï¼Œé€™ **éžå¸¸é‡è¦**ã€‚

**ä½†ç‚ºä»€éº¼æˆ‘å€‘è¦ä½¿ç”¨ `clearTimeout`ï¼Ÿ**

å› ç‚ºæˆ‘å€‘éœ€è¦åœ¨å»¶é²çµæŸå‰å–æ¶ˆé å®šçš„åŸ·è¡Œã€‚æˆ‘å€‘å·²ç¶“çŸ¥é“ `setTimeout` å›žå‚³ä¸€å€‹ç¨±ç‚ºè¶…æ™‚ IDï¼ˆtimeout IDï¼‰çš„å”¯ä¸€æ¨™è­˜ç¬¦ï¼Œå°å—Žï¼Ÿ

`clearTimeout` æ˜¯å¦ä¸€å€‹å…§å»ºå‡½æ•¸ï¼Œç”¨æ–¼å–æ¶ˆå…ˆå‰ä½¿ç”¨ `setTimeout` è¨­ç½®çš„è¶…æ™‚ã€‚é€šéŽå‚³éžè¶…æ™‚ ID çµ¦ `clearTimeout`ï¼Œæˆ‘å€‘å¯ä»¥é˜²æ­¢å›žå‘¼å‡½æ•¸çš„åŸ·è¡Œä¸¦åœæ­¢è¨ˆæ™‚å™¨ã€‚

**é‚„ä¸ç¢ºå®šå—Žï¼Ÿè®“æˆ‘å€‘å•è‡ªå·±ï¼Œå¦‚æžœä¸åœ¨ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨ `clearTimeout`ï¼Œæœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ!!**

çµåˆä½¿ç”¨ `clearTimeout` å’Œ `setTimeout` ç‚ºæˆ‘å€‘æä¾›äº†æŽ§åˆ¶é å®šå‡½æ•¸åŸ·è¡Œçš„èƒ½åŠ›ã€‚ç•¶æˆ‘å€‘ä½¿ç”¨ `setTimeout` è¨­ç½®ä¸€å€‹è¶…æ™‚æ™‚ï¼Œè©²å‡½æ•¸å…§çš„ç¨‹å¼ç¢¼æœƒåœ¨æŒ‡å®šçš„å»¶é²å¾Œé‹è¡Œã€‚ç„¶è€Œï¼Œé€šéŽä½¿ç”¨ `clearTimeout`ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å»¶é²çµæŸå‰å–æ¶ˆé å®šçš„å‡½æ•¸åŸ·è¡Œï¼Œé€™æ­£æ˜¯æˆ‘å€‘åœ¨é€™è£¡æƒ³è¦åšçš„ã€‚

ç°¡è€Œè¨€ä¹‹ï¼Œ`clearTimeout` å…è¨±ä½ èªªï¼Œã€Œå˜¿ï¼Œç­‰ç­‰ï¼æš«æ™‚ä¸è¦åŸ·è¡Œé‚£å€‹å‡½æ•¸ï¼ã€å®ƒè®“ä½ æœ‰èƒ½åŠ›æš«åœæˆ–å–æ¶ˆé å®šçš„åŸ·è¡Œï¼Œåœ¨éœ€è¦å‹•æ…‹æŽ§åˆ¶çš„æƒ…æ³ä¸‹æä¾›æ›´é †æš¢å’Œæ›´å…·å›žæ‡‰æ€§çš„ä½¿ç”¨è€…é«”é©—ã€‚

**çµè«–ï¼ˆCONCLUSIONï¼‰ï¼š**

æ²’æœ‰ `clearTimeout`ï¼Œä½ å°‡ç„¡æ³•åœæ­¢æˆ–å–æ¶ˆé å®šå‡½æ•¸çš„åŸ·è¡Œã€‚å®ƒå°‡ç„¡è«–ä»»ä½•å¾ŒçºŒé‚è¼¯æˆ–æ¢ä»¶å¦‚ä½•éƒ½æœƒåŸ·è¡Œã€‚é€šéŽä½¿ç”¨ `clearTimeout`ï¼Œä½ æœ‰èƒ½åŠ›ç®¡ç†å’Œèª¿æ•´ç¨‹å¼ç¢¼çš„æ™‚æ©Ÿï¼Œç¢ºä¿å®ƒæŒ‰ä½ éœ€è¦çš„æ–¹å¼é‹è¡Œã€‚

**æ–¹æ³•ï¼ˆApproachï¼‰ï¼š**

1. **ç¨‹å¼ç¢¼æ¦‚è¿°**ï¼š
    - è©²ç¨‹å¼ç¢¼å®šç¾©äº†ä¸€å€‹åç‚º `cancellable` çš„å‡½æ•¸ï¼ŒæŽ¥å—ä¸‰å€‹åƒæ•¸ï¼š`fn`ï¼ˆä¸€å€‹å‡½æ•¸ï¼‰ã€`args`ï¼ˆä¸€å€‹åƒæ•¸é™£åˆ—ï¼‰å’Œ `t`ï¼ˆä»¥æ¯«ç§’ç‚ºå–®ä½çš„æ™‚é–“å»¶é²ï¼‰ã€‚
    - åœ¨ `cancellable` å‡½æ•¸å…§ï¼Œå®šç¾©äº†ä¸€å€‹åµŒå¥—å‡½æ•¸ `cancelFn`ã€‚è©²å‡½æ•¸è² è²¬å–æ¶ˆé å®šçš„å‡½æ•¸åŸ·è¡Œã€‚
    - `cancelFn` å‡½æ•¸èª¿ç”¨ `clearTimeout` ä¸¦å‚³éžè¨ˆæ™‚å™¨æ¨™è­˜ç¬¦ä¾†å–æ¶ˆé å®šçš„å‡½æ•¸åŸ·è¡Œã€‚
    - ä½¿ç”¨ `setTimeout` å®‰æŽ’åœ¨æŒ‡å®šçš„æ™‚é–“å»¶é² `t` æ¯«ç§’å¾ŒåŸ·è¡Œä¸€å€‹å‡½æ•¸ã€‚
    - `setTimeout` å›žå‚³ä¸€å€‹è¨ˆæ™‚å™¨æ¨™è­˜ç¬¦ï¼Œå­˜å„²åœ¨ `timer` è®Šé‡ä¸­ã€‚
    - ä½¿ç”¨å±•é–‹é‹ç®—ç¬¦ï¼ˆspread operatorï¼‰`...args` å°‡åƒæ•¸é™£åˆ—å‚³éžçµ¦å‡½æ•¸ `fn`ï¼Œä»¥åŸ·è¡Œé å®šçš„å‡½æ•¸ã€‚
    - æœ€å¾Œï¼Œ`cancellable` å‡½æ•¸å›žå‚³ `cancelFn` å‡½æ•¸ï¼Œå…è¨±ä½ åœ¨éœ€è¦æ™‚èª¿ç”¨å®ƒä¾†å–æ¶ˆé å®šçš„å‡½æ•¸åŸ·è¡Œã€‚

2. **åˆå­¸è€…å¯èƒ½æœƒå•çš„å•é¡Œ**ï¼šç‚ºä»€éº¼è¦åœ¨é ‚éƒ¨å®šç¾© `cancelFn`ï¼Ÿ

    - å®šç¾© `cancelFn` å‡½æ•¸åœ¨é ‚éƒ¨çš„ç›®çš„æ˜¯ç¢ºä¿å®ƒåœ¨ `cancellable` å‡½æ•¸çš„ä½œç”¨åŸŸå…§æ˜¯å¯å­˜å–çš„ã€‚é€™è®“æˆ‘å€‘å¯ä»¥å°‡ `cancelFn` å‡½æ•¸ä½œç‚ºå‡½æ•¸çµæžœçš„ä¸€éƒ¨åˆ†å›žå‚³ï¼Œä½¿å…¶åœ¨ `cancellable` å‡½æ•¸å¤–éƒ¨å¯ç”¨ã€‚é€™æ˜¯ä¸€å€‹è‰¯å¥½çš„å¯¦è¸ï¼Œæ‡‰åœ¨é ‚éƒ¨å®šç¾©å‡½æ•¸ã€‚

**æœ€çµ‚çµè«–ï¼ˆFINAL CONCLUSIONï¼‰ï¼š**

ä½¿ç”¨ `clearTimeout` å’Œ `setTimeout` çš„æ¦‚å¿µæä¾›äº†ä¸€ç¨®å¼·å¤§çš„æ©Ÿåˆ¶ï¼Œç”¨æ–¼åœ¨ JavaScript ä¸­å®‰æŽ’å’Œå–æ¶ˆå‡½æ•¸çš„åŸ·è¡Œã€‚é€šéŽåˆ©ç”¨ `clearTimeout`ï¼Œç•¶ä¸å†éœ€è¦æ™‚ï¼Œä½ å¯ä»¥é˜²æ­¢é å®šçš„å‡½æ•¸é‹è¡Œï¼Œå¾žè€Œåœ¨ç®¡ç†éžåŒæ­¥ä»»å‹™æ™‚æä¾›æ›´å¤šçš„æŽ§åˆ¶å’Œéˆæ´»æ€§ã€‚é€™å€‹æ¦‚å¿µåœ¨ä½ å¸Œæœ›å»¶é²ç¨‹å¼ç¢¼åŸ·è¡Œæˆ–å®‰æŽ’æœªä¾†åŸ·è¡Œçš„ä»»å‹™æ™‚ç‰¹åˆ¥æœ‰ç”¨ã€‚æœ‰æ•ˆåœ°ç†è§£å’Œåˆ©ç”¨ `clearTimeout` å’Œ `setTimeout` å¯ä»¥å¤§å¤§æé«˜ä½ çš„ JavaScript ç¨‹å¼çš„æ•ˆçŽ‡å’Œå›žæ‡‰æ€§ã€‚



---

### **ç¨‹å¼ç¢¼ï¼ˆCodeï¼‰**

```javascript
/**
 * @param {Function} fn
 * @param {Array} args
 * @param {number} t
 * @return {Function}
 */
const cancellable = function(fn, args, t) {
    // cancelFn å‡½æ•¸
    const cancelFn = function (){
        clearTimeout(timer);
    };
    const timer = setTimeout(()=>{
        fn(...args);
    }, t);
    return cancelFn;
};


/**
 * const result = []
 *
 * const fn = (x) => x * 5
 * const args = [2], t = 20, cancelT = 50
 *
 * const log = (...argsArr) => {
 *     result.push(fn(...argsArr))
 * }
 *      
 * const cancel = cancellable(fn, args, t);
 *          
 * setTimeout(() => {
 *    cancel()
 *    console.log(result) // [{"time":20,"returned":10}]
 * }, cancelT);
 */
```
