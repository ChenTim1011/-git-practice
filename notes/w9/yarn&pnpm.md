我今天聽老師上課才知道除了 npm 以外，還有 yarn 和 pnpm， 也很好奇它們之間的差別!


[package-managers-comparison-yarn-npm-pnpm](https://www.cookielab.io/blog/package-managers-comparison-yarn-npm-pnpm)

以下是 **Yarn、NPM、PNPM** 三大 JavaScript 套件管理工具的簡單比較：

以下是文章的繁體中文翻譯：

---

# 套件管理工具比較：Yarn、NPM、PNPM

**Yarn**、**NPM** 和 **PNPM** 是 JavaScript 世界中的三大套件管理工具。
每個下載 Node.js 的人都會自帶 NPM，因此它是使用最普遍的。
Yarn 由 Meta 開發，而 PNPM 則是最新且速度最快的。

---

## NPM（Node Package Manager）的優缺點

NPM 是 Node.js 的預設套件管理工具，使用簡單且較少問題。由於它是預設的工具，NPM 擁有大量使用者社群，可以幫助你解決遇到的問題。儘管 NPM 相對穩定，但它還是有一些缺點。

**逐個安裝** 是 NPM 的一個缺點——套件是逐一安裝的，這會增加安裝時間。
另外一個缺點是 NPM 的 `npm audit` 工具。在安裝過程中你可能會收到“嚴重錯誤”警告，
這些可能會讓你緊張，但其實“嚴重錯誤”指的是某些潛在攻擊者可能可以獲得你電腦的完全控制權。
如果這真的是一個問題，那可能代表著你還有更多（更嚴重）的問題需要解決。

---

## Yarn 的優缺點

Yarn 的下載是平行進行速度更快。它提供離線模式，當網路中斷時也能正常運作，而且它的 Plug’n’Play 功能非常實用。

---

## Yarn 的 Hoisting 機制

Yarn 為了管理 node_modules 的問題做出改善。通常 node_modules 套件會很大，需要很長時間來複製、刪除或操作，
特別是當套件有許多依賴，且這些依賴有自己的依賴時，依賴樹會變得非常深，甚至會出現重複的套件版本。
為了解決這個問題，Yarn 使用了一種叫做 **Hoisting** 的技術。

Hoisting 將常用套件儘量提升到依賴樹的頂層，以便其他套件也能共享它們，減少下載和複製的需求。然而，這有一個有趣的缺點——你可能會意外地導入到某個子套件的功能，這個子套件是你所用的套件安裝的，而不是你自己安裝的。大多數現代 IDE 都能偵測到這個問題，但還是需要注意。

另一個潛在的缺點是 Hoisting 使用了 semver（語意化版本），如果有套件錯誤地使用這個標準，就可能導致問題。例如，它可能會將一個重大變更（版本 X.x.x）標記成了小變更（版本 x.X.x），而 Yarn 會不知情地下載該版本，從而導致問題發生。這在 GitHub 的某些問題頁面中常常被提到。

---

## Yarn 的 Plug'n'Play（PnP）

這就是為什麼 Yarn 引入了 **Plug'n'Play (PnP)**。PnP 移除了 node_modules 資料夾，將所有東西存放在一個全域目錄中。在專案中，我們只有一個 `.pnp.cjs` 檔案，裡面包含了套件的鏈接，並有一個 PnP 加載器，告訴你如何加載它們。這樣，我們可以在多個專案間共享，不必重複下載安裝。例如，如果你有多個 Next.js 專案，你不會想要每次都下載它。PnP 將一切統一存放在全域。

Yarn Plug'n'Play 的實現使用了所謂的「符號連結（symlink）」，也就是文件的原生連結。主要有兩種連結：

- **軟連結**：在移動檔案後連結就無效了
- **硬連結**：即使移動檔案，連結仍然有效

值得一提的是，Yarn 的 PnP 並非所有套件都支援，這可能會有點麻煩。你可能會想：「React Native 是個非常大的套件，我用 PnP 應該會更好。」但這樣做行不通，因為 React Native 使用自己的 Metro 編譯器，而 Metro 使用了符號連結。

如果你不想使用 PnP，可以在配置檔中設定 `node-linker` 模式，仍然能享受速度提升的好處。

---

## PNPM 的優缺點

PNPM 是最新且速度最快的套件管理工具。它的工作方式類似於 Yarn 的 PnP，也使用符號連結。
但是它不會下載整個套件，而只是下載版本間的差異。因此，你不需要重複下載整個函式庫。

另一個優點是，當你使用 PNPM 時，它會在控制台告訴你重複使用了多少套件並節省了多少磁碟空間，
如果你很重視「回收再利用」，一定會喜歡這個功能。

PNPM 也有與 PnP 相同的缺點，即可能並不支援所有的套件。

PNPM 的 node_modules 結構清晰易讀，能很清楚地分辨哪些是套件，哪些是連結。

---

## 套件管理工具的速度比較

根據測試結果，NPM 通常是最慢的。有趣的是，雖然 Yarn PnP 和 PNPM 使用相似的技術，但在速度上仍有一些明顯的差異。


---

## Node.js 新功能：CorePack

CorePack 是一個可以在控制台開啟的實驗性功能，它的目標是減少手動安裝 Yarn 或 PNPM 的需求。
Node.js 會在 `package.json` 中自動識別指定的套件管理工具，這是從版本 16.9.0 開始內建的功能，
非常方便使用。需要注意的是，使用 CorePack 指令會稍微更長，例如「yarn add foo」會變成「corepack yarn add foo」，但可以用別名來簡化。


